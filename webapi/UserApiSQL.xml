<?xml version="1.0" encoding="utf-8" ?>
<Queries>
	<!-- 确认用户名是否存在(注册登录都用到) -->
	<UserNameConfirm>
		SELECT reader_id
		FROM Reader
		WHERE reader_name = '{reader_name}'
	</UserNameConfirm>
	
	<!-- 新建用户 -->
	<InsertUser>
		INSERT INTO Reader (reader_id, reader_name, phone_number, email, address, reader_type, account, password)
		VALUES (reader_id_seq.nextval, '{reader_name}', '{phone_number}', '{email}', '{address}', '{reader_type}', '{account}', '{password}')
	</InsertUser>
	
	<!-- 用户登录 -->
	<UserLogin>
		SELECT *
		FROM Reader
		WHERE reader_name = '{reader_name}'
		AND password = '{password}'
	</UserLogin>
	<!-- 用户信息选择 -->
	<UserProfile>
		SELECT password
		FROM Reader
		WHERE reader_id = '{reader_id}'
	</UserProfile>

	<!-- 预约:查询发起预约的日期 -->
	<ReserveDate>
		SELECT *
		FROM Reserve
		WHERE reader_id = '{reader_id}'
		AND message = '已预约'
	</ReserveDate>

	<!-- 预约:更新预约状态 -->
	<ReserveMsgUpdate>
		UPDATE Reserve
		SET message = '逾期未取'
		WHERE reader_id = '{reader_id}'
		AND book_id = '{book_id}'
		AND message = '已预约'
	</ReserveMsgUpdate>
	<!-- 预约:更新书籍数量 -->
	<ReserveBkNUpdate>
		UPDATE Book
		SET num = num + 1
		WHERE book_id = '{book_id}'
	</ReserveBkNUpdate>
	<!-- 预约:增加违约记录 -->
	<ReserveReaderODUpdate>
		UPDATE Reader
		SET overdue_times = overdue_times + 1
		WHERE reader_id = '{reader_id}'
	</ReserveReaderODUpdate>

	<!-- 借阅:查询借阅的日期 -->
	<BorrowDate>
		SELECT *
		FROM BorrowRecord
		WHERE reader_id = '{reader_id}'
		AND (message = '已借阅' OR message = '续借中')
	</BorrowDate>
	<!-- 预约:更新借阅状态 -->
	<BorrowMsgUpdate>
		UPDATE BorrowRecord
		SET message = '逾期未还'
		WHERE reader_id = '{reader_id}'
		AND book_id = '{book_id}'
		AND (message = '已借阅' OR message = '续借中')
	</BorrowMsgUpdate>
	<!-- 预约:增加违约记录 -->
	<BorrowReaderODUpdate>
		UPDATE Reader
		SET overdue_times = overdue_times + 1
		WHERE reader_id = '{reader_id}'
	</BorrowReaderODUpdate>
</Queries>
