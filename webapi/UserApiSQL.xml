<?xml version="1.0" encoding="utf-8" ?>
<Queries>
	<!-- 确认用户名是否存在(注册登录都用到) -->
	<UserNameConfirm>
		SELECT reader_id
		FROM Reader
		WHERE reader_name = '{reader_name}'
	</UserNameConfirm>
	
	<!-- 新建用户 -->
	<InsertUser>
		INSERT INTO Reader (reader_id, reader_name, phone_number, email, address, reader_type, account, password)
		VALUES (reader_id_seq.nextval, '{reader_name}', '{phone_number}', '{email}', '{address}', '{reader_type}', '{account}', '{password}')
	</InsertUser>
	
	<!-- 用户登录 -->
	<UserLogin>
		SELECT *
		FROM Reader
		WHERE reader_name = '{reader_name}'
		AND password = '{password}'
	</UserLogin>

	<!-- 管理名确认以及登录 -->
	<AdminNameConfirm>
		SELECT admin_id
		FROM Administrator
		WHERE admin_name = '{reader_name}'
	</AdminNameConfirm>
	<AdminLogin>
		SELECT *
		FROM Administrator
		WHERE admin_name = '{reader_name}'
		AND password = '{password}'
	</AdminLogin >

	<!-- 用户信息选择 -->
	<UserProfile>
		SELECT password
		FROM Reader
		WHERE reader_id = '{reader_id}'
	</UserProfile>

	<!-- 预约:查询发起预约的日期 -->
	<ReserveDate>
		SELECT reserve_date
		FROM Reserve
		WHERE reader_id = '{reader_id}'
		AND message = '已预约'
	</ReserveDate>

	<!-- 预约:更新预约状态 -->
	<ReserveMsgUpdate>
		UPDATE Reserve
		SET message = '逾期未取'
		WHERE reader_id = '{readerId}'
		AND book_id = '{bookId}'
	</ReserveMsgUpdate>
	<!-- 预约:更新书籍数量 -->
	<ReserveBkNUpdate>
		UPDATE Book
		SET num = num + 1
		WHERE book_id = '{bookId}'
	</ReserveBkNUpdate>
	<!-- 预约:增加违约记录 -->
	<ReserveReaderODUpdate>
		UPDATE Reader
		SET overdue_times = overdue_times + 1
		WHERE reader_id = '{readerId}'
	</ReserveReaderODUpdate>
</Queries>
